{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Violet Bites application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., 'user', 'admin')."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "role"
      ]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MenuItem",
      "type": "object",
      "description": "Represents an item on the menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu item."
        },
        "name": {
          "type": "string",
          "description": "The name of the menu item."
        },
        "description": {
          "type": "string",
          "description": "A description of the menu item."
        },
        "price": {
          "type": "number",
          "description": "The price of the menu item."
        },
        "category": {
          "type": "string",
          "description": "The category of the menu item (e.g., 'meals', 'snacks')."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL for the image of the menu item.",
          "format": "uri"
        },
        "stock": {
          "type": "number",
          "description": "The available stock quantity of the menu item."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "category",
        "stock"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "The date and time the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount of the order."
        },
        "status": {
          "type": "string",
          "description": "The status of the order (e.g., 'pending', 'confirmed', 'delivered')."
        },
        "convenienceFee": {
          "type": "number",
          "description": "The convenience fee added to the order."
        },
        "orderItemIds": {
          "type": "array",
          "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount",
        "status",
        "convenienceFee",
        "orderItemIds"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "menuItemId": {
          "type": "string",
          "description": "Reference to MenuItem. (Relationship: MenuItem 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "The quantity of the menu item in the order."
        },
        "price": {
          "type": "number",
          "description": "The price of the menu item at the time of order."
        }
      },
      "required": [
        "id",
        "orderId",
        "menuItemId",
        "quantity",
        "price"
      ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the payment."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:1 Payment)"
        },
        "paymentDate": {
          "type": "string",
          "description": "The date and time the payment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "The amount paid."
        },
        "paymentMethod": {
          "type": "string",
          "description": "The method of payment (e.g., 'credit card', 'bank transfer')."
        },
        "transactionId": {
          "type": "string",
          "description": "The transaction ID from the payment gateway."
        },
        "canteenOwnerAccountId": {
          "type": "string",
          "description": "Identifier for the canteen owner's account where payment will be routed.  This is an external ID for a system outside the scope of this data model."
        }
      },
      "required": [
        "id",
        "orderId",
        "paymentDate",
        "amount",
        "paymentMethod",
        "transactionId",
        "canteenOwnerAccountId"
      ]
    },
    "AdminDashboard": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminDashboard",
      "type": "object",
      "description": "Represents data shown on the admin dashboard, including payment statistics, sales analysis, and canteen details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the dashboard data record."
        },
        "dateGenerated": {
          "type": "string",
          "description": "Date and time when the dashboard data was generated.",
          "format": "date-time"
        },
        "totalSalesAmount": {
          "type": "number",
          "description": "Total sales amount for the period covered by the dashboard."
        },
        "numberOfOrders": {
          "type": "number",
          "description": "Number of orders placed during the period."
        },
        "mostPopularItem": {
          "type": "string",
          "description": "ID of the most popular menu item sold during the period. References MenuItem.id. (Relationship: Dashboard 1:1 MenuItem)"
        },
        "averageOrderValue": {
          "type": "number",
          "description": "Average order value for the period."
        }
      },
      "required": [
        "id",
        "dateGenerated",
        "totalSalesAmount",
        "numberOfOrders",
        "mostPopularItem",
        "averageOrderValue"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Authorization is based on path-based ownership: only the user with ID {userId} can read/write their own document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/menu_items/{menuItemId}",
        "definition": {
          "entityName": "MenuItem",
          "schema": {
            "$ref": "#/backend/entities/MenuItem"
          },
          "description": "Stores menu items. Assumed to be publicly readable but only writable by admins.",
          "params": [
            {
              "name": "menuItemId",
              "description": "The unique identifier for the menu item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for a specific user. Authorization is based on path-based ownership: only the user with ID {userId} can read/write orders under their path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/order_items/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual order items for a specific order, allowing more granular access control and scalability if OrderItem entities become large. Authorization is based on path-based ownership: only the user with ID {userId} can read/write order_items under their path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/payments/{paymentId}",
        "definition": {
          "entityName": "Payment",
          "schema": {
            "$ref": "#/backend/entities/Payment"
          },
          "description": "Stores payment information for a specific user. Authorization is based on path-based ownership: only the user with ID {userId} can read/write payments under their path.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "paymentId",
              "description": "The unique identifier for the payment."
            }
          ]
        }
      },
      {
        "path": "/admin_dashboards/{dashboardId}",
        "definition": {
          "entityName": "AdminDashboard",
          "schema": {
            "$ref": "#/backend/entities/AdminDashboard"
          },
          "description": "Stores admin dashboard data. Access is restricted to users with the 'admin' role.",
          "params": [
            {
              "name": "dashboardId",
              "description": "The unique identifier for the dashboard data record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to provide a secure, scalable, and debuggable solution for the Violet Bites application, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs.  It uses path-based ownership where appropriate and membership maps for collaborative data access.\n\n*   **Authorization Independence:**  The primary strategy for achieving authorization independence is the use of path-based ownership (e.g., `/users/{userId}/orders/{orderId}`).  No `get()` calls are needed in rules to determine ownership. For collaborative data, denormalization is used (though no collaborative data was specified in the prompt).\n*   **Clarity of Intent:**  The structure makes authorization intent clear through consistent naming conventions (e.g., `userId` for user-owned data) and explicit state modeling (e.g., `status` field in `Order`).\n*   **DBAC (No Custom Claims):**  Authorization relies solely on `request.auth.uid` and roles stored in the database.\n*   **QAPs (Rules are not Filters):**  The structure enables secure `list` operations by segregating data with different access needs into separate collections and using path-based ownership.  This ensures that rules can be written to allow listing only resources the user has access to.\n\nSpecifically:\n\n*   **Users:** User data is stored in `/users/{userId}`, enabling easy, secure access based on the user's ID.  The `role` field within the user document is used to determine admin privileges.\n*   **Menu Items:** Menu items are stored in a single `/menu_items` collection. Since there is no mention of specific access rules or roles needed in the prompt, they are assumed to be publicly readable. Admin-only access for modification of the menu will be handled by rules that check the `role` field of the user.\n*   **Orders:** Orders are stored in `/users/{userId}/orders/{orderId}`, enabling user-specific order access. The `userId` in the path enforces ownership.  OrderItem IDs are embedded as an array in the Order document. This approach avoids the need to query a subcollection for order items during the most common operations, potentially simplifying client-side code and reducing read costs.\n*   **Order Items:** Order items can be directly accessed under `/users/{userId}/orders/{orderId}/order_items/{orderItemId}`. This nested subcollection structure provides a straightforward and secure way to manage items associated with a specific order.\n*   **Payments:** Payment documents are stored in a subcollection `/users/{userId}/payments/{paymentId}` associated with a specific user. This allows easy lookup of payment information for each user.\n*   **Admin Dashboard:** Admin dashboard data is stored in `/admin_dashboards/{dashboardId}`.  Access to this collection is restricted to users with the `admin` role."
  }
}
